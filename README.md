# SNMP

SNMP is typically used to gather environment and performance data such as device CPU usage, memory usage, interface traffic, interface error rate, and so on.

There are two main components of SNMP:

1. SNMP Manager network management system (NMS): Collects management data from managed devices via polling or trap messages.
2. SNMP Agent: Found on a managed network device, it locally organizes data and sends it to the manager.

## Configuration

Configuration of SNMP v3 on Cisco devices is done using these steps: create view; create group; create user and define destination host (last step is required for ASA, but optional for others).

We will configure SNMP v3 with authentication and privacy (option authPriv) using next parameters:

Username: UserJustMe
Authentication Password: AuthPass1
Privacy Password: PrivPass2
View Name: ViewDefault
Group Name: GrpMonitoring

### Classic IOS & IOS-XE
This SNMP configuration will work on all devices that use classic IOS (like Cisco Catalyst 3650, 3750, 3850, 2960, 2950, 2801, 2911 or routers 1841, 1921 etc.) and IOS-XE (like ASR1000, Catalyst 9000…).
```
snmp-server view ViewDefault iso included
snmp-server group GrpMonitoring v3 priv read ViewDefault
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2
```
Note that SNMP users are not stored in running or startup configuration, so the “snmp-server user” line will not be visible via “show running-config”.

### IOS-XR based Routers
This configuration will work on device that use IOS-XR (like CRS series, 12000 series, and ASR9000 series…)
```
snmp-server view ViewDefault iso included 
snmp-server group GrpMonitoring v3 priv read ViewDefault
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2
```

### Nexus Switch (OS-NX)
SNMP groups on Nexus (like series 7000, 9000 .. ) are replaced by roles for Role-Based Access Control and by default new users will have network-operator permissions. As a side effect, they can log-in via CLI to the switch and have access to all show commands.

Use “role” set of commands because they can be used as groups in SNMP.
```
snmp-server user UserJustMe network-admin v3 auth sha AuthPass1 priv aes-128 PrivPass2
```

### ASA firewall
```
snmp-server group GrpMonitoring v3 priv
snmp-server user UserJustMe GrpMonitoring v3 auth sha AuthPass1 priv aes 128 PrivPass2
snmp-server host mgmt 10.1.1.161 version 3 UserJustMe
```
In this example, I have used the “mgmt” interface for SNMP communication with a monitoring system (NMS) with IP address “10.1.1.161.” You probably have a different network configuration, so change the interface and IP address.

## Configuring SNMPv3 Traps / Informs

You can use noAuth, Auth or Priv security options for traps/informs and in this tutorial we will configure SNMP notifications in 4 different ways:

Traps without Authentication and Privacy
Traps with only Authentication
Traps with Authentication and Privacy (encryption)
Informs with Authentication and Privacy (encryption)
```
Enable Traps without Authentication / Privacy
! Enable all traps
snmp-server enable traps
!
! …or insted select just some traps, for example:
! snmp-server enable traps envmon fan shutdown supply temperature status ospf cpu
!
snmp-server group trapgroup v3 noauth
snmp-server user trapuser trapgroup v3
snmp-server host 10.1.1.161 traps version 3 noauth trapuser
! Trap receiver must also have user defined locally.
```
Enable Traps with only Authentication
```
! Enable all traps
snmp-server enable traps
!
! …or insted select just some traps, for example:
! snmp-server enable traps envmon fan shutdown supply temperature status ospf cpu
!
snmp-server group trapgroup v3 auth
snmp-server user trapuser trapgroup v3 auth sha AuthPass
snmp-server host 10.1.1.161 traps version 3 auth trapuser 
! Trap receiver must also have user and password defined locally.
```
Enable Traps with Authentication and Privacy
```
! Enables all traps
snmp-server enable traps
!
! …or insted select just some traps, for example:
! snmp-server enable traps envmon fan shutdown supply temperature status ospf cpu
!
snmp-server group trapgroup v3 priv
snmp-server user trapuser trapgroup v3 auth sha AuthPass priv 3des PrivPass
snmp-server host 10.1.1.161 traps version 3 priv trapuser
! Trap receiver must also have user and password defined locally.
```
Enable Informs with Authentication and Privacy
```
! Enables all traps
snmp-server enable traps
!
! …or insted select just some traps, for example:
! snmp-server enable traps envmon fan shutdown supply temperature status ospf cpu
!
! EngineID is automatically generated by the router, use "show snmp engineID" to check
snmp-server engineID remote 10.1.1.161 800005E510763D0FFC1245N1A4
snmp-server group trapgroup v3 priv
snmp-server user trapuser trapgroup remote 10.1.1.161 v3 auth sha AuthPass priv 3des PrivPass
snmp-server host 10.1.1.161 informs version 3 priv trapuser
!trap receiver must also have user and password defined locally.
```
One more thing to note, EngineID is not stored in the running configuration!


## SNMP Context name
With SNMPv3, there is no Community String, so nothing to index with – we use context name instead.


Enabling SNMPv3 context name
Make sure that device can see the contexts with command “show snmp context“:

# Note: not supported in some devices e.g Cat2950
```
router#show snmp context
 vlan-1
 vlan-2
 vlan-3
```
Configuration of SNMPv3 context name is straightfoward:
```
# Add SNMPv3 context name for each vlan on device
snmp-server group GrpMonitoring v3 auth context vlan- match prefix
```
```
# Command above will not work for IOS versions before 12.4(20)T, you must add a line for each VLAN
snmp-server group GrpMonitoring v3 auth context vlan-1
snmp-server group GrpMonitoring v3 auth context vlan-30
snmp-server group GrpMonitoring v3 auth context vlan-32
```
You can test configuration above by manually polling a VLAN using contexts with NetSNMP tool:
```
# Using OID dot1dTpFdbAddress (1.3.6.1.2.1.17.4.3.1.1) and SNMPv3 context name to get mac addresses in VLAN 32
snmpwalk -v3 -l authNoPriv -u UserJustMe -a MD5 -A AuthPass1 -n vlan-32 192.168.1.1 1.3.6.1.2.1.17.4.3.1.1
```


